<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Creating collapsible output with knitr chunk hooks – W. Joel Schneider</title><meta name=author content="W. Joel Schneider"><meta name=description content="W. Joel Schneider's Academic Website"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6 crossorigin=anonymous><link rel=stylesheet href=https://wjschne.github.io/css/all.min.css><link rel=stylesheet href=https://wjschne.github.io/css/academicons.min.css><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.css><link rel=stylesheet href=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css><link rel=stylesheet href=https://wjschne.github.io/css/main.css><link rel=stylesheet href=https://wjschne.github.io/css/fonts.css><link rel=icon type=image/png href=https://wjschne.github.io/favicon.png><link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css rel=stylesheet type=text/css></head><body data-spy=scroll data-target=#toc><div class=container><header><link rel=alternate type=application/rss+xml href=https://wjschne.github.io/index.xml><nav class="navbar navbar-expand-sm bg-dark navbar-dark d-flex mt-2 py-0"><div class=d-inline-flex><ul class=navbar-nav><li class=nav-item><a href=https://wjschne.github.io/ title=Home class=nav-link><i class='fa fa-home'></i></span></a></li><li class=nav-item><a href=https://wjschne.github.io/posts/ title=Posts class=nav-link>Posts</a></li><li class=nav-item><a href=https://wjschne.github.io/presentations title=Presentations class=nav-link>Presentations</a></li><li class=nav-item><a href=https://wjschne.github.io/projects/ title=Projects class=nav-link>Projects</a></li><li class=nav-item><a href=https://wjschne.github.io/courses/ title=Courses class=nav-link>Courses</a></li><li class=nav-item><a href=https://wjschne.github.io/vita title=Vita class=nav-link>Vita</a></li><li class=nav-item><a href=https://wjschne.github.io/contact title="Contact Me" class=nav-link><i class="fas fa-id-card"></i></span></a></li></ul></div></nav></header><div id=content><article class=post><header class=p-2><div class=row><div class=col-md-9><h2>Creating collapsible output with knitr chunk hooks</h2></div><div class="col-md-3 text-md-end"><span class=small>2023-06-30</span></div></div><p>By W. Joel Schneider</p></header><div class="bg-light p-2"><h2>Summary</h3>How to make the output of a knitr code chunk collapsible using knitr hooks.</div><section class=body><p>I am writing a <a href=https://individual-psychometrics.rbind.io/>(still very much unfinished) psychometrics book</a> with suggested exercises using R. I wanted to provide solutions to the questions, but I wanted to hide the answers until the reader clicks them.</p><p>An easy way to create collapsible content is with html’s <code>&lt;details></code> tag. For example:</p><pre class=default><code>Create a variable `x`, and assign it a value of 5.

&lt;details&gt;
  &lt;summary&gt;Suggested Solution&lt;/summary&gt;

```{r}
x &lt;- 5
```
&lt;/details&gt;</code></pre><p>Create a variable <code>x</code>, and assign it a value of 5.</p><details><summary>Suggested Solution</summary><pre class=r><code>x &lt;- 5</code></pre></details><hr><p>However, I did not want to worry about all the <code>&lt;details></code> every time I wrote a question. To automate this process, I used two knitr hooks: a chunk hook and an option hook.</p><p><a href=https://bookdown.org/yihui/rmarkdown-cookbook/chunk-hooks.html>Chunk hooks</a> are for customizing the output of a chunk.</p><p>Here I create a new chunk hook that is run before and after the chunk. When it is run before the chunk, it adds the <code>&lt;details></code> and <code>&lt;summary></code> tags. After the chunk, it closes the <code>&lt;details></code> tag.</p><pre class=r><code># Add the details tag before running the chunk 
# and close the tag after running the chunk.
knitr::knit_hooks$set(
  solutionsetter = function(before,options) {
  
  if (before) {
    
    &quot;\n\n&lt;details&gt;&lt;summary&gt;Suggested Solution&lt;/summary&gt;\n\n&quot;
    
  } else {
    
    &quot;\n\n&lt;/details&gt;\n\n&quot;
    
  }
})</code></pre><p>If all we needed to do was to enclose the output into a <code>&lt;details></code> tag, then just the <code>solutionsetter</code> hook would be needed. However, I also wanted to set <code>echo=TRUE</code> so that the output would be visible even if the default for <code>echo</code> was <code>FALSE</code>.</p><p><a href=https://bookdown.org/yihui/rmarkdown-cookbook/option-hooks.html>Option hooks</a> are great for when you have a kind of chunk you will use often, and it requires setting many chunk options at once (e.g., a plot variant with different dimensions than your default plot has).</p><p>Here I create a new option hook called <code>solution</code>. It sets the current chunk’s <code>echo</code> option to <code>TRUE</code> and also triggers the new <code>solutionsetter</code> code chunk below. The updated <code>options</code> list needs to be returned explicitly, or the hook will not work.</p><pre class=r><code>knitr::opts_hooks$set(solution = function(options) {
  options$echo &lt;- TRUE
  options$solutionsetter &lt;- TRUE
  return(options)
})</code></pre><p>Now all need to do is to set my chunk option to <code>solution = TRUE</code> and the output will be collapsible:</p><pre class=default><code>
Create a variable `x`, and assign it a value of 5.

```{r, solution = TRUE}
x &lt;- 5
```</code></pre><p>Create a variable <code>x</code>, and assign it a value of 5.</p><details><summary>Suggested Solution</summary><pre class=r><code>x &lt;- 5</code></pre></details><hr><div id=the-details-package class="section level1"><h1>The details package</h1><p>If you want a function to enclose the output of a chunk or inline code in <code>&lt;details></code> tags, use the <a href="https://cran.r-project.org/package=details">details</a> package by Jonathan Sidi. For example, an inline chunk like this:</p><pre class=default><code>`r details::details(&quot;Answer&quot;, summary = &quot;Question&quot;)`</code></pre><p>Will output like so:</p><details closed><summary><span title="Click to Expand">Question</span></summary><pre class=r><code>
Answer
</code></pre></details><p><br></p><p>The package has many other uses, which are explained in the <a href=https://yonicd.github.io/details/articles/index.html>package’s vignettes</a>.</p></div></section></article></div><footer><nav class="nav navbar-expand-md bg-dark navbar-dark my-1"><ul class=navbar-nav><li class=nav-item><a href="mailto:W.%20Joel%20Schneider%20%3cschneider@temple.edu%3e?subject=Question%20from%20your%20website&amp;body=Dear%20Dr.%20Schneider%2C%0D%0A" class=nav-link target=_blank><i class="far fa-envelope" title=Email></i><span class="d-inline d-md-none">Email</span></a></li><li class=nav-item><a href=https://wjschne.github.io/media/schneider-vita.pdf class=nav-link target=_blank><i class="ai ai-cv" title="Curriculum Vitae"></i><span class="d-inline d-md-none">Curriculum Vitae</span></a></li><li class=nav-item><a href=https://www.researchgate.net/profile/W-Schneider-3 class=nav-link target=_blank><i class="ai ai-researchgate" title=ResearchGate></i><span class="d-inline d-md-none">ResearchGate</span></a></li><li class=nav-item><a href="https://scholar.google.com/citations?hl=en&amp;pli=1&amp;user=aojOxP4AAAAJ" class=nav-link target=_blank><i class="ai ai-google-scholar" title="Google Scholar"></i><span class="d-inline d-md-none">Google Scholar</span></a></li><li class=nav-item><a href=https://orcid.org/0000-0002-8393-5316 class=nav-link target=_blank><i class="ai ai-orcid" title=Orchid></i><span class="d-inline d-md-none">Orchid</span></a></li><li class=nav-item><a href=https://osf.io/whabf/ class=nav-link target=_blank><i class="ai ai-osf" title="Open Science Framework"></i><span class="d-inline d-md-none">Open Science Framework</span></a></li><li class=nav-item><a href=https://www.zotero.org/wjschne class=nav-link target=_blank><i class="ai ai-zotero" title=Zotero></i><span class="d-inline d-md-none">Zotero</span></a></li><li class=nav-item><a href=https://github.com/wjschne class=nav-link target=_blank><i class="fab fa-github" title=GitHub></i><span class="d-inline d-md-none">GitHub</span></a></li><li class=nav-item><a href=https://stackoverflow.com/users/4513316/joel-schneider class=nav-link target=_blank><i class="ai ai-stackoverflow" title=stackoverflow></i><span class="d-inline d-md-none">stackoverflow</span></a></li><li class=nav-item><a href=https://fosstodon.org/@wjoelschneider class=nav-link target=_blank><i class="fab fa-mastodon" title=Mastodon></i><span class="d-inline d-md-none">Mastodon</span></a></li><li class=nav-item><a href=https://www.youtube.com/channel/UCFTUraTjxq743KfH-5gWrWg class=nav-link target=_blank><i class="fab fa-youtube" title=YouTube></i><span class="d-inline d-md-none">YouTube</span></a></li></ul></nav><p class=text-end><i class="fas fa-copyright"></i>2023</p></footer></div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script>
<script>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><script src=https://wjschne.github.io/js/math-code.js></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<script src=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js></script></body></html>