<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Insert Text from One Markdown Document into Another â€“ W. Joel Schneider</title><meta name=author content="W. Joel Schneider"><meta name=description content="W. Joel Schneider's Academic Website"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6 crossorigin=anonymous><link rel=stylesheet href=https://wjschne.github.io/css/all.min.css><link rel=stylesheet href=https://wjschne.github.io/css/academicons.min.css><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.css><link rel=stylesheet href=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css><link rel=stylesheet href=https://wjschne.github.io/css/main.css><link rel=stylesheet href=https://wjschne.github.io/css/fonts.css><link rel=icon type=image/png href=https://wjschne.github.io/favicon.png><link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css rel=stylesheet type=text/css></head><body data-spy=scroll data-target=#toc><div class=container><header><link rel=alternate type=application/rss+xml href=https://wjschne.github.io/index.xml><nav class="navbar navbar-expand-sm bg-dark navbar-dark d-flex mt-2 py-0"><div class=d-inline-flex><ul class=navbar-nav><li class=nav-item><a href=https://wjschne.github.io/ title=Home class=nav-link><i class='fa fa-home'></i></span></a></li><li class=nav-item><a href=https://wjschne.github.io/posts/ title=Posts class=nav-link>Posts</a></li><li class=nav-item><a href=https://wjschne.github.io/presentations title=Presentations class=nav-link>Presentations</a></li><li class=nav-item><a href=https://wjschne.github.io/projects/ title=Projects class=nav-link>Projects</a></li><li class=nav-item><a href=https://wjschne.github.io/courses/ title=Courses class=nav-link>Courses</a></li><li class=nav-item><a href=https://wjschne.github.io/vita title=Vita class=nav-link>Vita</a></li><li class=nav-item><a href=https://wjschne.github.io/contact title="Contact Me" class=nav-link><i class="fas fa-id-card"></i></span></a></li></ul></div></nav></header><div id=content><article class=post><header class=p-2><div class=row><div class=col-md-9><h2>Insert Text from One Markdown Document into Another</h2></div><div class="col-md-3 text-md-end"><span class=small>2023-03-30</span></div></div><p>By W. Joel Schneider</p></header><section class=body><p>While assembling a reply letter for a revise-and-resubmit document, I was documenting for reviewers how we addressed their concerns. The reply letter quoted numerous sentences and paragraphs that had been changed. Unfortunately, each time my co-authors and I edited the paper, I lost track of which sentences and paragraphs I had previously copied into the reply letter. I did not want to misquote my own paper.</p><p>Copying-and-pasting with each edit was getting tedious, and it was an error-prone process. I decided to write a function that would retrieve a named div or span from the paper and print it as a quote in my reply letter. Here it is:</p><pre class=r><code>get_quote &lt;- function(id, file, blockquote = TRUE) {
  blocktext &lt;- ifelse(blockquote, &quot;\n&gt; &quot;, &quot;&quot;)

  refreplace &lt;- function(x) {
    # List of sequence types
    crossrefs &lt;- c(`@fig-` = &quot;Figure&quot;,
                   `@fig-` = &quot;Table&quot;,
                   `@eq-` = &quot;Equation&quot;,
                   `@thm-` = &quot;Lemma&quot;,
                   `@lem-` = &quot;Corollary&quot;,
                   `@cor-` = &quot;Proposition&quot;,
                   `@prp-` = &quot;Conjecture&quot;,
                   `@cnj-` = &quot;Definition&quot;,
                   `@def-` = &quot;Example&quot;,
                   `@exm-` = &quot;Example&quot;,
                   `@exr-` = &quot;Exercise&quot;,
                   `apafg-` = &quot;Figure&quot;,
                   `apatb-` = &quot;Figure&quot;
    )

    # Find all crossreference types and number them
    make_replacements &lt;- function(x, reftype, prefix) {
      regstring &lt;- ifelse(stringr::str_starts(reftype, &quot;\\@&quot;),
                          paste0(&quot;\\&quot;, reftype, &quot;(.*?)(?=[\\.\\?\\!\\]\\}\\s,])&quot;),
                          paste0(&quot;\\{&quot;, reftype, &quot;(.*?)\\}&quot;))
      patterns &lt;- stringr::str_extract_all(string = x, pattern = regstring) |&gt;
        unlist() |&gt;
        unique() |&gt;
        stringr::str_replace(&quot;\\{&quot;, &quot;\\\\{&quot;) |&gt;
        stringr::str_replace(&quot;\\}&quot;, &quot;\\\\}&quot;)

      if (all(is.na(patterns))) return(NULL)
      replacements &lt;- paste(prefix, seq_along(patterns))
      names(replacements) &lt;- patterns
      replacements
    }
    allreplacements &lt;- purrr::map2(
      names(crossrefs),
      crossrefs,
      \(rt, pf) make_replacements(
        x = x,
        reftype = rt,
        prefix = pf)) |&gt;
      unlist()

    stringr::str_replace_all(x, allreplacements)

  }

  filetext &lt;- readLines(file) |&gt;
    refreplace()

  idcount &lt;- sum(stringr::str_count(filetext, paste0(&quot;#&quot;, id)))
  if (idcount &gt; 1)
    stop(paste0(
      &quot;The id (&quot;,
      id ,
      &quot;) is not unique. There are &quot;,
      idcount,
      &quot; instances of id = &quot;,
      id,
      &quot;.&quot;
    ))

  s &lt;- filetext |&gt;
    paste0(collapse = &quot;\n&quot;) |&gt;
    stringr::str_match(pattern = paste0(&quot;(?&lt;=\\[).+(?=\\]\\{\\#&quot;,
                               id,
                               &quot;\\})&quot;))  |&gt;
    getElement(1)

  if (is.na(s)) {
    s &lt;- filetext |&gt;
      paste0(collapse = &quot;|||&quot;) |&gt;
      stringr::str_match(pattern = paste0(&quot;:::\\{\\#&quot;,
                                 id,
                                 &quot;\\}(.*?):::&quot;))  |&gt;
      getElement(2) |&gt;
      stringr::str_replace_all(&quot;\\|\\|\\|&quot;, blocktext)
  } else {
    s &lt;- paste0(blocktext, s)
  }

  if (is.na(s)) stop(&quot;Could not find a div or span with id = &quot;, id)

  s
}</code></pre><p>For your convenience and mine, I have added this function into the <a href=https://wjschne.github.io/WJSmisc/reference/get_quote.html>WJSmisc package</a>.</p><div id=using-the-get_quote-function class="section level1"><h1>Using the <code>get_quote</code> function</h1><p>If the file has a span or div with a specified id, the <code>get_quote</code> function can find it. Suppose the file has a span with id of <code>id1</code> and a div with id of <code>id2</code>.</p><pre><code>[Text in a span]{#id1}

:::{#id2}
Here are two pagagraphs in a fenced div.

This is the second paragraph.
:::

cat(get_quote(&quot;id2&quot;, &quot;index.Rmd&quot;))</code></pre><p>You can pull text from the current file or another file. This file happened to be named <code>index.Rmd</code>. The text inside the span with id <code>id1</code> can be extracted with inline chunks like so:</p><pre class=default><code>`r get_quote(&quot;id1&quot;, &quot;index.Rmd&quot;)`</code></pre><blockquote><p>Text in a span</p></blockquote><p>Here we extract the two paragraphs in div id2</p><pre class=default><code>`r get_quote(&quot;id2&quot;, &quot;index.Rmd&quot;)`</code></pre><blockquote><p>Here are two pagagraphs in a fenced div.</p><p>This is the second paragraph.</p></blockquote><div id=remove-blockquote-formatting class="section level2"><h2>Remove blockquote formatting</h2><p>By default, the function adds a <code>></code> before each line in the quoted markdown so that it appears as a block quote. You can turn off the block quote formatting like so:</p><pre class=default><code>`r get_quote(&quot;id1&quot;, &quot;index.Rmd&quot;, blockquote = FALSE)`</code></pre><p>Text in a span</p></div><div id=curly-braces-with-additional-information class="section level2"><h2>Curly braces with additional information</h2><p>What if you need to put additional information in the curly braces of the span or div (e.g., a css class)?</p><pre class=default><code>[Here is more text with extra stuff in the curly braces.]{#id3 .myclass}</code></pre><p>You can trick the function into thinking that the extra stuff is part of the id like so:</p><pre class=default><code>`r get_quote(&quot;id3 .myclass&quot;, &quot;index.Rmd&quot;)`</code></pre><blockquote><p>Here is more text with extra stuff in the curly braces.</p></blockquote></div></div></section></article></div><footer><nav class="nav navbar-expand-md bg-dark navbar-dark my-1"><ul class=navbar-nav><li class=nav-item><a href="mailto:W.%20Joel%20Schneider%20%3cschneider@temple.edu%3e?subject=Question%20from%20your%20website&amp;body=Dear%20Dr.%20Schneider%2C%0D%0A" class=nav-link target=_blank><i class="far fa-envelope" title=Email></i><span class="d-inline d-md-none">Email</span></a></li><li class=nav-item><a href=https://wjschne.github.io/media/schneider-vita.pdf class=nav-link target=_blank><i class="ai ai-cv" title="Curriculum Vitae"></i><span class="d-inline d-md-none">Curriculum Vitae</span></a></li><li class=nav-item><a href=https://www.researchgate.net/profile/W-Schneider-3 class=nav-link target=_blank><i class="ai ai-researchgate" title=ResearchGate></i><span class="d-inline d-md-none">ResearchGate</span></a></li><li class=nav-item><a href="https://scholar.google.com/citations?hl=en&amp;pli=1&amp;user=aojOxP4AAAAJ" class=nav-link target=_blank><i class="ai ai-google-scholar" title="Google Scholar"></i><span class="d-inline d-md-none">Google Scholar</span></a></li><li class=nav-item><a href=https://orcid.org/0000-0002-8393-5316 class=nav-link target=_blank><i class="ai ai-orcid" title=Orchid></i><span class="d-inline d-md-none">Orchid</span></a></li><li class=nav-item><a href=https://osf.io/whabf/ class=nav-link target=_blank><i class="ai ai-osf" title="Open Science Framework"></i><span class="d-inline d-md-none">Open Science Framework</span></a></li><li class=nav-item><a href=https://www.zotero.org/wjschne class=nav-link target=_blank><i class="ai ai-zotero" title=Zotero></i><span class="d-inline d-md-none">Zotero</span></a></li><li class=nav-item><a href=https://github.com/wjschne class=nav-link target=_blank><i class="fab fa-github" title=GitHub></i><span class="d-inline d-md-none">GitHub</span></a></li><li class=nav-item><a href=https://stackoverflow.com/users/4513316/joel-schneider class=nav-link target=_blank><i class="ai ai-stackoverflow" title=stackoverflow></i><span class="d-inline d-md-none">stackoverflow</span></a></li><li class=nav-item><a href=https://fosstodon.org/@wjoelschneider class=nav-link target=_blank><i class="fab fa-mastodon" title=Mastodon></i><span class="d-inline d-md-none">Mastodon</span></a></li><li class=nav-item><a href=https://www.youtube.com/channel/UCFTUraTjxq743KfH-5gWrWg class=nav-link target=_blank><i class="fab fa-youtube" title=YouTube></i><span class="d-inline d-md-none">YouTube</span></a></li></ul></nav><p class=text-end><i class="fas fa-copyright"></i>2023</p></footer></div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script>
<script>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><script src=https://wjschne.github.io/js/math-code.js></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<script src=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js></script></body></html>