<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Point labels perpendicular to a curve in ggplot2 – W. Joel Schneider</title><meta name=author content="W. Joel Schneider">
<meta name=description content="W. Joel Schneider's Academic Website">
<link href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6 crossorigin=anonymous>
<link rel=stylesheet href=/css/all.min.css>
<link rel=stylesheet href=/css/academicons.min.css>
<link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.css>
<link rel=stylesheet href=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css>
<link rel=stylesheet href=/css/main.css>
<link rel=stylesheet href=/css/fonts.css>
<link rel=icon type=image/png href=/favicon.png>
<link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css rel=stylesheet type=text/css>
</head><body data-spy=scroll data-target=#toc>
<div class=container><header>
<link rel=alternate type=application/rss+xml href=/index.xml><nav class="navbar navbar-expand-sm bg-dark navbar-dark d-flex mt-2 py-0">
<div class=d-inline-flex>
<ul class=navbar-nav>
<li class=nav-item>
<a href=/ title=Home class=nav-link>
<i class="fa fa-home"></i> </span>
</a>
</li><li class=nav-item>
<a href=/posts/ title=Posts class=nav-link>
Posts
</a>
</li><li class=nav-item>
<a href=/presentations title=Presentations class=nav-link>
Presentations
</a>
</li><li class=nav-item>
<a href=/projects/ title=Projects class=nav-link>
Projects
</a>
</li><li class=nav-item>
<a href=/courses/ title=Courses class=nav-link>
Courses
</a>
</li><li class=nav-item>
<a href=/vita title=Vita class=nav-link>
Vita
</a>
</li><li class=nav-item>
<a href=/contact title="Contact Me" class=nav-link>
<i class="fas fa-id-card"></i> </span>
</a>
</li></ul></div></nav></header><div id=content>
<article class=post>
<header class=p-2>
<div class=row>
<div class=col-md-9>
<h2>Point labels perpendicular to a curve in ggplot2 </h2></div><div class="col-md-3 text-md-end">
<span class=small>2021-07-27
</span>
</div></div><p>
By W. Joel Schneider
</p></header><div class="bg-light p-2">
<h2>Summary</h3>How to place legible labels for points on a curve in ggplot2</div><section class=body>
<script src=/posts/point-labels-perpendicular-to-a-curve-in-ggplot2/index_files/header-attrs/header-attrs.js></script>
<p>I would like to label points on a sine function so that the labels are always legible. In a sine wave plot in which <span class="math inline">\(\theta\)</span> ranges from 0 to 2<span class="math inline">\(\pi\)</span>, <span class="math inline">\(\sin(\theta)\)</span> ranges from −1 to +1. Thus, the plot’s xy ratio is</p><p><span class="math display">\[\text{plot ratio}= \frac{2\pi-0}{1- (-1)}=\pi\]</span></p><p>The first derivative of the sine function is the cosine function. In my plot, the slope of the tangent line at each point is</p><p><span class="math display">\[
\text{tangent slope} = \text{plot ratio}\times \cos(\theta)
\]</span>
The angle of the tangent line’s slope is the arctan of the slope. I would like to place the label perpendicular to the tangent line so I will add 90 degrees (i.e., <span class="math inline">\(\pi/2\)</span> radians).</p><p><span class="math display">\[
\text{text angle}=\tan^{-1}(\text{tangent slope})+\pi/2
\]</span></p><p>Now I need a pair of functions that will convert this angle into the right values for ggplot2’s <code>hjust</code> and <code>vjust</code> arguments. I have added the <code>angle2vjust</code> and <code>angle2hjust</code> functions to the <a href=https://github.com/wjschne/WJSmisc>WJSmisc package</a>, but I have defined them here as well:</p><pre class=r><code>angle2vjust &lt;- function(theta, multiplier = 1, as_degrees = FALSE) {
  if (as_degrees) theta &lt;- theta * pi / 180
  (((sin(theta + pi) + 1) / 2) - 0.5) * multiplier + 0.5
}

angle2hjust &lt;- function(theta, multiplier = 1, as_degrees = FALSE) {
  if (as_degrees) theta &lt;- theta * pi / 180
  (((cos(theta + pi) + 1) / 2) - 0.5) * multiplier + 0.5
}</code></pre><p>Now we plot the sine function with labels. I have used <code>geom_richtext</code> from the <a href=https://github.com/wilkelab/ggtext>ggtext package</a> because it allows me to set a white background along with padding and margins.</p><pre class=r><code>library(tidyverse)
library(ggtext)

plot_ratio &lt;- pi

tibble(theta = seq(0, 2 * pi, length.out = 13),
            y =  sin(theta),
            tangent_slope = cos(theta) * plot_ratio,
            text_angle = atan(tangent_slope) + pi / 2) %&gt;%
  ggplot(aes(theta, y)) +
  geom_richtext(aes(label = round(y, 2),
                    vjust = angle2vjust(text_angle),
                    hjust = angle2hjust(text_angle)),
                label.color = NA,
                label.padding = unit(1, &quot;pt&quot;),
                label.margin = unit(5, &quot;pt&quot;),
                size = 4) +
  geom_point() +
  stat_function(fun = sin) +
  scale_x_continuous(expression(theta),
                     breaks = seq(0, 2 * pi, length.out = 13),
                     minor_breaks = NULL,
                     labels = function(x) round(x * 180 / pi)) +
  scale_y_continuous(expression(sin(theta))) +
  coord_fixed(ratio = plot_ratio, clip = &quot;off&quot;) +
  theme_minimal(base_size = 16)</code></pre><p><img src=/posts/point-labels-perpendicular-to-a-curve-in-ggplot2/index_files/figure-html/sine-perpendicular-1.svg width=672></p><p>If you do not mind turning your head to one side or the other, a somewhat easier method is to set the label’s <code>vjust</code> to a negative value and rotate the labels by the angle of the tangent line:</p><pre class=r><code>tibble(theta = seq(0, 2 * pi, length.out = 13),
            y = sin(theta),
            tangent_slope = cos(theta) * plot_ratio,
            text_angle = atan(tangent_slope)) %&gt;%
  ggplot(aes(theta, y)) +
  geom_richtext(aes(label = round(y, 2),
                    angle = text_angle * 180 / pi),
                vjust = 0,
                label.color = NA,
                label.padding = unit(1, &quot;pt&quot;),
                label.margin = unit(2, &quot;pt&quot;),
                size = 4) +
  geom_point() +
  stat_function(fun = sin) +
  scale_x_continuous(expression(theta),
                     breaks = seq(0, 2 * pi, length.out = 13),
                     minor_breaks = NULL,
                     labels = function(x) round(x * 180 / pi)) +
  scale_y_continuous(expression(sin(theta))) +
  coord_fixed(ratio = plot_ratio, clip = &quot;off&quot;) +
  theme_minimal(base_size = 16)</code></pre><p><img src=/posts/point-labels-perpendicular-to-a-curve-in-ggplot2/index_files/figure-html/sine-sloped-1.svg width=672></p><p>What if you do not know the function’s first derivative? You can approximate the slope of the tangent line by comparing a function’s output of each point with the output of a slightly deviated point. Here is a plot of the normal cumulative distribution function.</p><pre class=r><code># Small change in x
dx &lt;- .00000001
plot_ratio &lt;- 6

tibble(x = seq(-3,3,.5),
       y = pnorm(x),
       tangent_slope = plot_ratio * (pnorm(x + dx) - y) / dx,
       text_angle = atan(tangent_slope) + pi / 2,
       degrees = text_angle * 180 / pi) %&gt;% 
  ggplot(aes(x,y)) + 
  geom_point() +
  geom_richtext(aes(label = formatC(y, 2, format = &quot;f&quot;),
                    vjust = angle2vjust(text_angle),
                    hjust = angle2hjust(text_angle)),
                label.color = NA,
                label.padding = unit(1, &quot;pt&quot;),
                label.margin = unit(5, &quot;pt&quot;),
                size = 4) +
  stat_function(fun = pnorm) + 
  theme_minimal(base_size = 16) + 
  coord_fixed(ratio = plot_ratio) + 
  scale_x_continuous(expression(x), breaks = -3:3) +
  scale_y_continuous(expression(Phi(x)))</code></pre><p><img src=/posts/point-labels-perpendicular-to-a-curve-in-ggplot2/index_files/figure-html/normalcdf-1.svg width=672></p></section></article></div><footer>
<nav class="nav navbar-expand-md bg-dark navbar-dark my-1">
<ul class=navbar-nav>
<li class=nav-item>
<a href="mailto:W.%20Joel%20Schneider%20%3cschneider@temple.edu%3e?subject=Question%20from%20your%20website&body=Dear%20Dr.%20Schneider%2C%0D%0A" class=nav-link target=_blank>
<i class="far fa-envelope" title=Email> </i>
<span class="d-inline d-md-none">Email</span>
</a>
</li><li class=nav-item>
<a href=/media/schneider-vita.pdf class=nav-link target=_blank>
<i class="ai ai-cv" title="Curriculum Vitae"> </i>
<span class="d-inline d-md-none">Curriculum Vitae</span>
</a>
</li><li class=nav-item>
<a href=https://www.researchgate.net/profile/W-Schneider-3 class=nav-link target=_blank>
<i class="ai ai-researchgate" title=ResearchGate> </i>
<span class="d-inline d-md-none">ResearchGate</span>
</a>
</li><li class=nav-item>
<a href="https://scholar.google.com/citations?hl=en&pli=1&user=aojOxP4AAAAJ" class=nav-link target=_blank>
<i class="ai ai-google-scholar" title="Google Scholar"> </i>
<span class="d-inline d-md-none">Google Scholar</span>
</a>
</li><li class=nav-item>
<a href=https://orcid.org/0000-0002-8393-5316 class=nav-link target=_blank>
<i class="ai ai-orcid" title=Orchid> </i>
<span class="d-inline d-md-none">Orchid</span>
</a>
</li><li class=nav-item>
<a href=https://osf.io/whabf/ class=nav-link target=_blank>
<i class="ai ai-osf" title="Open Science Framework"> </i>
<span class="d-inline d-md-none">Open Science Framework</span>
</a>
</li><li class=nav-item>
<a href=https://www.zotero.org/wjschne class=nav-link target=_blank>
<i class="ai ai-zotero" title=Zotero> </i>
<span class="d-inline d-md-none">Zotero</span>
</a>
</li><li class=nav-item>
<a href=https://github.com/wjschne class=nav-link target=_blank>
<i class="fab fa-github" title=GitHub> </i>
<span class="d-inline d-md-none">GitHub</span>
</a>
</li><li class=nav-item>
<a href=https://stackoverflow.com/users/4513316/joel-schneider class=nav-link target=_blank>
<i class="ai ai-stackoverflow" title=stackoverflow> </i>
<span class="d-inline d-md-none">stackoverflow</span>
</a>
</li><li class=nav-item>
<a href=https://twitter.com/WJoelSchneider class=nav-link target=_blank>
<i class="fab fa-twitter" title=Twitter> </i>
<span class="d-inline d-md-none">Twitter</span>
</a>
</li><li class=nav-item>
<a href=https://www.youtube.com/channel/UCFTUraTjxq743KfH-5gWrWg class=nav-link target=_blank>
<i class="fab fa-youtube" title=YouTube> </i>
<span class="d-inline d-md-none">YouTube</span>
</a>
</li></ul></nav><p class=text-end>
<i class="fas fa-copyright"> </i> 2022
</p></footer></div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script>
<script>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script>
<script src=/js/math-code.js></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<script src=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js></script>
</body></html>