<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Splitting sentence texts into roughly equal segments – W. Joel Schneider</title><meta name=author content="W. Joel Schneider"><meta name=description content="W. Joel Schneider's Academic Website"><link href=https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css rel=stylesheet integrity=sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6 crossorigin=anonymous><link rel=stylesheet href=https://wjschne.github.io/css/all.min.css><link rel=stylesheet href=https://wjschne.github.io/css/academicons.min.css><link rel=stylesheet type=text/css href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.css><link rel=stylesheet href=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css><link rel=stylesheet href=https://wjschne.github.io/css/main.css><link rel=stylesheet href=https://wjschne.github.io/css/fonts.css><link rel=icon type=image/png href=https://wjschne.github.io/favicon.png><link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css rel=stylesheet type=text/css></head><body data-spy=scroll data-target=#toc><div class=container><header><link rel=alternate type=application/rss+xml href=https://wjschne.github.io/index.xml><nav class="navbar navbar-expand-sm bg-dark navbar-dark d-flex mt-2 py-0"><div class=d-inline-flex><ul class=navbar-nav><li class=nav-item><a href=https://wjschne.github.io/ title=Home class=nav-link><i class='fa fa-home'></i></span></a></li><li class=nav-item><a href=https://wjschne.github.io/posts/ title=Posts class=nav-link>Posts</a></li><li class=nav-item><a href=https://wjschne.github.io/presentations title=Presentations class=nav-link>Presentations</a></li><li class=nav-item><a href=https://wjschne.github.io/projects/ title=Projects class=nav-link>Projects</a></li><li class=nav-item><a href=https://wjschne.github.io/courses/ title=Courses class=nav-link>Courses</a></li><li class=nav-item><a href=https://wjschne.github.io/vita title=Vita class=nav-link>Vita</a></li><li class=nav-item><a href=https://wjschne.github.io/contact title="Contact Me" class=nav-link><i class="fas fa-id-card"></i></span></a></li></ul></div></nav></header><div id=content><article class=post><header class=p-2><div class=row><div class=col-md-9><h2>Splitting sentence texts into roughly equal segments</h2></div><div class="col-md-3 text-md-end"><span class=small>2023-05-31</span></div></div><p>By W. Joel Schneider</p></header><div class="bg-light p-2"><h2>Summary</h3>For long text labels on the y-axis, splitting them into roughly equal segments can look better.</div><section class=body><p>When analyzing questionnaire data, I sometimes put the text of several questions on the y-axis of a plot. Longer text strings will usually make the plot too narrow.</p><p>Suppose we give an admittedly silly questionnaire about preference for darker food. We want to display the percentages of people answering “Yes” to each question.</p><p>Here are the questions and the (completely made-up) percentages:</p><pre class=r><code># To install the WJSmisc package:
# remotes::install_github(&quot;wjschne/WJSmisc&quot;)
library(WJSmisc)
library(tidyverse)
d &lt;- tibble(Item = c(&quot;When you drink coffee, do you prefer darker roasts?&quot;,
                     &quot;Is pumpernickel the best bread?&quot;,
                     &quot;Do you like dark chocolate more than you like milk chocolate?&quot;,
                     &quot;Are black olives better than green olives?&quot;,
                     &quot;Do you enjoy the taste of prunes more than can be prudently admitted aloud?&quot;,
                     &quot;Is black licorice the secret to a happly life?&quot;),
            Percentage = c(45,4,37, 84,2, 3)) |&gt; 
  mutate(Item = fct_reorder(Item, Percentage))</code></pre><p>A preliminary plot might look like this:</p><pre class=r><code>myfont &lt;- &quot;Roboto Condensed&quot;
mycolors &lt;- viridis::viridis(n = nrow(d), begin = .2, end = .8) |&gt; tinter::lighten(.5)
mytextsize &lt;- 17
mytext &lt;- &quot;gray60&quot;
p &lt;- ggplot(d, aes(Percentage, Item)) + 
  geom_col(aes(fill = factor(Percentage))) + 
  geom_richlabel(aes(label = paste0(Percentage, &quot;%&quot;), 
                     color = factor(Percentage)), 
                 hjust = 0, fill = &quot;black&quot;,
                 text_size = mytextsize,
                 family = myfont) +
  labs(y = NULL,
       caption = &quot;Note: These numbers were made up for illustrative purposes.&quot;) +
  theme_minimal(base_size = mytextsize, base_family = myfont) +
  scale_x_continuous(&quot;Percent Yes&quot;, 
                     limits = c(0,100), 
                     breaks = NULL,
                     expand = expansion(mult = c(0,.2))) +
  scale_fill_manual(values = mycolors) +
  scale_color_manual(values = mycolors) +
  theme(plot.title.position = &quot;plot&quot;, 
        plot.background = element_rect(&quot;black&quot;),
        plot.title = element_text(colour = mytext),
        plot.caption = element_text(color = &quot;gray40&quot;),
        legend.position = &quot;none&quot;,
        axis.title = element_text(color = mytext),
        panel.grid.major.y = element_blank(),
        axis.text = element_text(color = mycolors))
p + ggtitle(&quot;Y-axis labels with no text wrapping&quot;)</code></pre><p><img src=https://wjschne.github.io/posts/splitting-sentence-texts-into-roughly-equal-segments/index_files/figure-html/basicplot-1.png width=672></p><p>The questions are taking up a lot of space. We can fix this by using <code>stringr::str_wrap</code> to make the text lines no longer than a specified width:</p><pre class=r><code>p + 
  scale_y_discrete(labels = \(x) str_wrap(x, width = 30)) + 
  ggtitle(&quot;Splitting Y-axis labels with str_wrap&quot;)</code></pre><p><img src=https://wjschne.github.io/posts/splitting-sentence-texts-into-roughly-equal-segments/index_files/figure-html/wrapplot-1.png width=672></p><p>This is a definite improvement, but I wish the lines of text were wrapped more evenly. For example, I do not like the fact that “chocolate” and “bread” are by themselves on their own lines. I have spent a fair amount of time breaking lines up by hand and hoped to create a function to automate the process. To achieve a more balanced style of text splitting, I made the <code>str_wrap_equal</code> function.</p><pre class=r><code>p + scale_y_discrete(labels = \(x) str_wrap_equal(x, max_width = 30)) + 
  ggtitle(&quot;Splitting Y-axis labels with str_wrap_equal&quot;)</code></pre><p><img src=https://wjschne.github.io/posts/splitting-sentence-texts-into-roughly-equal-segments/index_files/figure-html/wrapequalplot-1.png width=672></p><p>To each their own, but this style of text wrapping feels better to me here. It is the sort of thing no one but the analyst will notice if it is right but will feel a bit off if not.</p><p>For your convenience and mine, I put the <code>str_wrap_equal</code> function in the <a href=https://wjschne.github.io/WJSmisc/reference/str_wrap_equal.html>WJSmisc package</a>.</p><div id=technical-details class="section level2"><h2>Technical Details</h2><p>I hesitate to post a new function because the odds are quite high that someone has already done what I did. However, my initial search did not locate a function that does exactly what I needed. If you know of a function have I duplicated unnecessarily, let me know.</p><p>In deciding whether to break the line, the function does the following:</p><ol style=list-style-type:decimal><li>Calculate the overall length of the text (i.e., number of characters).</li><li>Find <em>k</em> (the number of lines likely needed) by dividing the overall text length by <code>max_width</code> and round up to the nearest integers.</li><li>Calculate the preferred width of the line by dividing the overall text length by the number of lines likely needed.</li><li>Add to the line one word at a time as long as doing so makes the current line width closer to the preferred width. If not, a new line is started.</li><li>The function will not make a line longer than what is specified by <code>max_width</code> unless it has to place a single, lonely word that is longer than <code>max_width</code>.</li></ol><p>Here is the code for the function. Any suggestions to improve it are welcome.</p><pre class=r><code>str_wrap_equal &lt;- function(x, max_width = 30L, sep = &quot;\n&quot;) {
  purrr::map_chr(x, \(xi) {
    # Find overall text length
    xlen &lt;- stringr::str_length(xi)
    # Remove any line breaks and allow lines to break at forward slashes
    xi &lt;- stringr::str_replace(xi, &quot;\n&quot;, &quot; &quot;) |&gt; 
      stringr::str_replace(&quot;/&quot;, &quot;/ &quot;)
    # Number of lines likely needed
    k &lt;- ceiling(xlen / max_width)
    # Optimal line length
    preferred_width &lt;- xlen / k
    # Split text into words
    words &lt;- stringr::str_split(xi, pattern = &quot; &quot;, simplify = F)[[1]]
    # Number of words in text
    k_words &lt;- length(words)
    # Length of each word in text
    word_len &lt;- stringr::str_length(words)
    # Create empty text lines with a few extra, if needed
    textlines &lt;- rep(&quot;&quot;, k + 10)
    # Current text line
    i &lt;- 1
    # Decide whether to add a word to the current line or to start a new line
    for (w in seq(k_words)) {
      # Width of current line before adding a new word
      current_width &lt;- stringr::str_length(textlines[i])
      # Width of current line if a new word is added
      proposed_width &lt;- current_width + word_len[w] + 1
      # Difference between current width and preferred width
      current_difference &lt;- abs(current_width - preferred_width)
      # Difference between proposed width and preferred width
      proposed_difference &lt;- abs(proposed_width - preferred_width)
      # Should we start a new line?
      if (current_difference &lt; proposed_difference | proposed_width &gt; max_width) {
        i &lt;- i + 1
      }
      # Add word to current line, remove spaces, and rejoin words divided by forward slashes
      textlines[i] &lt;- stringr::str_trim(paste(textlines[i], words[w])) |&gt;
        stringr::str_replace(&quot;/ &quot;, &quot;/&quot;)
    }
    # Collapse non-empty lines by separation character
    paste0(textlines[stringr::str_length(textlines) &gt; 0], collapse = sep)
  })

}</code></pre></div></section></article></div><footer><nav class="nav navbar-expand-md bg-dark navbar-dark my-1"><ul class=navbar-nav><li class=nav-item><a href="mailto:W.%20Joel%20Schneider%20%3cschneider@temple.edu%3e?subject=Question%20from%20your%20website&amp;body=Dear%20Dr.%20Schneider%2C%0D%0A" class=nav-link target=_blank><i class="far fa-envelope" title=Email></i><span class="d-inline d-md-none">Email</span></a></li><li class=nav-item><a href=https://wjschne.github.io/media/schneider-vita.pdf class=nav-link target=_blank><i class="ai ai-cv" title="Curriculum Vitae"></i><span class="d-inline d-md-none">Curriculum Vitae</span></a></li><li class=nav-item><a href=https://www.researchgate.net/profile/W-Schneider-3 class=nav-link target=_blank><i class="ai ai-researchgate" title=ResearchGate></i><span class="d-inline d-md-none">ResearchGate</span></a></li><li class=nav-item><a href="https://scholar.google.com/citations?hl=en&amp;pli=1&amp;user=aojOxP4AAAAJ" class=nav-link target=_blank><i class="ai ai-google-scholar" title="Google Scholar"></i><span class="d-inline d-md-none">Google Scholar</span></a></li><li class=nav-item><a href=https://orcid.org/0000-0002-8393-5316 class=nav-link target=_blank><i class="ai ai-orcid" title=Orchid></i><span class="d-inline d-md-none">Orchid</span></a></li><li class=nav-item><a href=https://osf.io/whabf/ class=nav-link target=_blank><i class="ai ai-osf" title="Open Science Framework"></i><span class="d-inline d-md-none">Open Science Framework</span></a></li><li class=nav-item><a href=https://www.zotero.org/wjschne class=nav-link target=_blank><i class="ai ai-zotero" title=Zotero></i><span class="d-inline d-md-none">Zotero</span></a></li><li class=nav-item><a href=https://github.com/wjschne class=nav-link target=_blank><i class="fab fa-github" title=GitHub></i><span class="d-inline d-md-none">GitHub</span></a></li><li class=nav-item><a href=https://stackoverflow.com/users/4513316/joel-schneider class=nav-link target=_blank><i class="ai ai-stackoverflow" title=stackoverflow></i><span class="d-inline d-md-none">stackoverflow</span></a></li><li class=nav-item><a href=https://fosstodon.org/@wjoelschneider class=nav-link target=_blank><i class="fab fa-mastodon" title=Mastodon></i><span class="d-inline d-md-none">Mastodon</span></a></li><li class=nav-item><a href=https://www.youtube.com/channel/UCFTUraTjxq743KfH-5gWrWg class=nav-link target=_blank><i class="fab fa-youtube" title=YouTube></i><span class="d-inline d-md-none">YouTube</span></a></li></ul></nav><p class=text-end><i class="fas fa-copyright"></i>2023</p></footer></div><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js></script>
<script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js></script>
<script>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><script src=https://wjschne.github.io/js/math-code.js></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js></script>
<script src=https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js></script></body></html>